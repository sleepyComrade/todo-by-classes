(()=>{"use strict";var t=function(t){this.wrap=document.createElement("div"),this.wrap.className="wrapper",t.append(this.wrap)},e=function(t,e,n,i,a,s){var o=this;this.api=a,this.itemData=s,this.parent=t,this.value=n,this.mainWrap=i,this.task=document.createElement("div"),this.task.className="task-wrap",this.parent.list.append(this.task),this.text=document.createElement("p"),this.text.textContent=this.value,this.itemData.done&&(this.text.className="task-done"),this.task.append(this.text),this.control=document.createElement("div"),this.control.className="controls-wrap",this.task.append(this.control),this.closeBtn=document.createElement("button"),this.closeBtn.className="close-task-button",this.closeBtn.textContent="x",this.closeBtn.onclick=function(){o.closeBtn.textContent="loading...",o.itemData.id&&o.api.removeItem(o.itemData.id).then((function(t){o.closeBtn.textContent="x",o.task.remove()})).catch((function(t){console.log("rejected"),o.closeBtn.textContent="rejected"}))},this.control.append(this.closeBtn),this.editBtn=document.createElement("button"),this.editBtn.className="edit-task-button",this.editBtn.textContent="edit",this.editBtn.onclick=function(){e(o.mainWrap,o.parent,o.itemData,!1).onClose=function(t,e){t?o.text.classList.add("task-done"):o.text.classList.remove("task-done"),o.text.textContent=e}},this.control.append(this.editBtn)},n=function(){function t(t,e,n,i,a,s){var o=this;this.api=i,this.parent=t,this.taskList=e,this.showPopup=n,this.itemData=a||{name:"",done:!1,id:void 0},this.isNew=s,this.overlay=document.createElement("div"),this.overlay.className="overlay",this.overlay.onclick=function(){return o.closePopup()},this.popup=document.createElement("div"),this.popup.className="popup-wrap",this.button=document.createElement("button"),this.button.className="close-button",this.button.textContent="x",this.button.onclick=function(){return o.closePopup()},this.popup.append(this.button),this.input=document.createElement("input"),this.input.className="popup-input",this.input.setAttribute("type","text"),this.input.placeholder="add a task",this.itemData.name&&(this.input.value=this.itemData.name),this.input.onkeydown=function(t){"Enter"===t.key&&o.applyTask()},this.popup.append(this.input),this.state=document.createElement("div"),this.state.className="state-wrap",this.popup.append(this.state),this.checkbox=document.createElement("input"),this.checkbox.type="checkbox",this.checkbox.className="state-checkbox",this.itemData.done&&(this.checkbox.checked=!0),this.checkbox.onchange=function(){return o.itemData.done=!!o.checkbox.checked},this.state.append(this.checkbox),this.stateDesc=document.createElement("p"),this.stateDesc.textContent="Done",this.state.append(this.stateDesc),this.applybutton=document.createElement("button"),this.applybutton.className="apply-button",this.applybutton.textContent="Ok",this.applybutton.onclick=function(){return o.applyTask()},this.popup.append(this.applybutton)}return t.prototype.openPopup=function(){this.parent.wrap.append(this.overlay),this.parent.wrap.append(this.popup),this.input.focus()},t.prototype.closePopup=function(){this.overlay.remove(),this.popup.remove()},t.prototype.applyTask=function(){var t=this;void 0===this.itemData&&(this.itemData={name:"",done:!1,id:void 0}),this.itemData.name=this.input.value,this.input.value?this.isNew?(this.api.getIdNum(this.itemData),this.applybutton.textContent="loading...",this.api.addItem(this.itemData).then((function(n){console.log(n),t.applybutton.textContent="Ok",new e(t.taskList,t.showPopup,t.input.value,t.parent,t.api,t.itemData),t.closePopup()})).catch((function(e){console.log("rejected"),t.applybutton.textContent="rejected",t.api.removeErrItem(),t.api.correctIdCount()}))):this.isNew||(this.applybutton.textContent="loading...",this.itemData.id&&this.api.editItem(this.itemData.id,this.itemData).then((function(e){console.log(e),t.applybutton.textContent="Ok",t.onClose(t.itemData.done,t.input.value),t.closePopup()})).catch((function(e){console.log("rejected"),t.applybutton.textContent="rejected",t.api.removeErrItem()}))):alert("add a task please")},t}(),i=function(t,e,n){var i=this;this.parent=e,this.list=n,this.button=document.createElement("button"),this.button.className="openButton",this.button.textContent="+",this.button.onclick=function(){return t(i.parent,i.list,{name:"",done:!1,id:void 0},!0)},e.wrap.insertBefore(this.button,e.wrap.firstChild)},a=function(t){this.list=document.createElement("div"),this.list.className="task-list",t.wrap.append(this.list)};new function(e){var s=this;this.api=e,this.mainWrap=new t(document.body),this.taskList=new a(this.mainWrap),this.showPopup=function(t,e,i,a){var o=new n(t,e,s.showPopup,s.api,i,a);return o.openPopup(),o},this.addButton=new i(this.showPopup,this.mainWrap,this.taskList)}(new(function(){function t(t){this._data=JSON.parse(JSON.stringify(t)),this.idInitial=this._data.length}return t.prototype._fakeSend=function(t){return new Promise((function(e,n){setTimeout((function(){Math.random()<.1?n("Fake server reject"):e(JSON.stringify(t))}),1e3*Math.random()+50)}))},t.prototype.getList=function(){return this._fakeSend(this._data)},t.prototype.addItem=function(t){return this._data.push(t),this._fakeSend(this._data)},t.prototype.removeItem=function(t){var e;return this._data.forEach((function(n,i){n.id===t&&(e=i)})),void 0!==e&&this._data.splice(e,1),this._fakeSend(this._data)},t.prototype.editItem=function(t,e){return this._data.splice(t,1,e),this._fakeSend(this._data)},t.prototype.removeErrItem=function(){this._data.pop()},t.prototype.correctIdCount=function(){this.idInitial--},t.prototype.getIdNum=function(t){t.id=this.idInitial,this.idInitial++},t}())([{name:"a",done:!0},{name:"abc",done:!1},{name:"sjfdk",done:!1}]))})();
//# sourceMappingURL=bundle.js.map